"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[792],{787:()=>{var t,n=function(){function t(t,n,o){this.distance=t,this.angleVertical=n,this.angleHorizontal=o}return t.prototype.toCartesian=function(t){var n=(this.angleVertical+90)*Math.PI/180,i=this.angleHorizontal*Math.PI/180,e=this.distance*Math.sin(n)*Math.cos(i),r=this.distance*Math.sin(n)*Math.sin(i),s=this.distance*Math.cos(n),a=new o(e,r,s);return t?a.add(t):a},t}(),o=function(){function t(t,n,o){this.x=t,this.y=n,this.z=o}return t.prototype.add=function(n){return new t(this.x+n.x,this.y+n.y,this.z+n.z)},t.prototype.subtract=function(n){return new t(this.x-n.x,this.y-n.y,this.z-n.z)},t.prototype.toSpherical=function(t){var o=t?this.subtract(t):this,i=o.x,e=o.y,r=o.z,s=Math.sqrt(i*i+e*e+r*r);return new n(s,180*Math.acos(r/s)/Math.PI-90,180*Math.atan(e/i)/Math.PI)},t}(),i=function(){function t(t){this.point=t}return t.prototype.getAngle=function(t){if(this===t)return 0;var n=this.point.x,o=this.point.y,i=this.point.z,e=t.point.x,r=t.point.y,s=t.point.z,a=(n*e+o*r+i*s)/(Math.sqrt(n*n+o*o+i*i)*Math.sqrt(e*e+r*r+s*s));return 180*Math.acos(a)/Math.PI},t}(),e=function(){function t(t,n,o){this.point1=t,this.point2=n,this.point3=o}return t.prototype.getPlaneEquation=function(){var t=this.point1.x,n=this.point1.y,o=this.point1.z,i=this.point2.x,e=this.point2.y,r=this.point2.z,s=i-t,a=this.point3.x-t,c=e-n,u=this.point3.y-n,h=r-o,l=this.point3.z-o;return{coefficients:[c*l-u*h,a*h-s*l,s*u-a*c],constant:t*(u*h-c*l)+n*(s*l-a*h)+o*(a*c-s*u)}},t.prototype.pointInside=function(t){var n=new i(this.point1.subtract(t)),o=new i(this.point2.subtract(t)),e=new i(this.point3.subtract(t));return n.getAngle(o)+o.getAngle(e)+e.getAngle(n)>=359.999999},t}(),r=(t=function(n,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])},t(n,o)},function(n,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}),s=function(t){function n(n){var o=t.call(this,n)||this;return o.name="MatrixError",o}return r(n,t),n}(Error),a=function(){var t=function(n,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])},t(n,o)};return function(n,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),c=function(t){function n(n){var o=t.call(this,n)||this;return o.name="MatrixOperationError",o}return a(n,t),n}(s);function u(t){if(0===t.length)return!0;for(var n=0,o=t;n<o.length;n++){if(o[n]!==t[0])return!1}return!0}var h=function(){function t(t){if(!t)throw new s("Matrix is empty");this.values=t;var n=this.calculateSize();this.columns=n.columns,this.rows=n.rows}return t.prototype.add=function(n){if(this.rows!==n.rows||this.columns!==n.columns)throw new c("Matrix sizes are different. ".concat(this.rows,"x").concat(this.columns,", ").concat(n.rows,"x").concat(n.columns));return new t(this.values.map(function(t,o){return t.map(function(t,i){return t+n.values[o][i]})}))},t.prototype.multiply=function(n){return n instanceof t?this.multiplyByMatrix(n):this.multiplyByNumber(n)},t.prototype.subtract=function(n){if(this.rows!==n.rows||this.columns!==n.columns)throw new c("Matrix sizes are different. ".concat(this.rows,"x").concat(this.columns,", ").concat(n.rows,"x").concat(n.columns));return new t(this.values.map(function(t,o){return t.map(function(t,i){return t-n.values[o][i]})}))},t.prototype.throwSizeError=function(t,n){throw new s("Matrix must be ".concat(t," rows and ").concat(n," columns. Now is ").concat(this.rows,"x").concat(this.columns))},t.prototype.calculateSize=function(){var t;if(0===(t=this.values.length))throw new s("There are no rows in matrix");var n=this.values.map(function(t){return t.length});if(!u(n))throw new s("Lengths of rows are different: ".concat(n));if(0===this.values[0].length)throw new s("There are no columns in matrix");return{rows:t,columns:this.values[0].length}},t.prototype.multiplyByNumber=function(n){return new t(this.values.map(function(t){return t.map(function(t){return t*n})}))},t.prototype.multiplyByMatrix=function(n){for(var o=[],i=0;i<this.rows;i++){for(var e=[],r=0;r<n.columns;r++){for(var s=0,a=0;a<this.columns;a++)s+=this.values[i][a]*n.values[a][r];e.push(s)}o.push(e)}return new t(o)},t}(),l=function(){function t(t,n){this.rotation=t,this.pivot=n,n||(this.pivot=new o(0,0,0))}return t.prototype.rotatePoint=function(t){var n,i,e=this.rotation.x*Math.PI/180,r=this.rotation.y*Math.PI/180,s=this.rotation.z*Math.PI/180,a=t.subtract(null!==(n=this.pivot)&&void 0!==n?n:new o(0,0,0)),c=new h([[1,0,0],[0,Math.cos(e),-Math.sin(e)],[0,Math.sin(e),Math.cos(e)]]),u=new h([[Math.cos(r),0,Math.sin(r)],[0,1,0],[-Math.sin(r),0,Math.cos(r)]]),l=new h([[Math.cos(s),-Math.sin(s),0],[Math.sin(s),Math.cos(s),0],[0,0,1]]),p=c.multiply(new h([[a.x],[a.y],[a.z]])),f=u.multiply(p),y=l.multiply(f),v=y.values[0][0],w=y.values[1][0],d=y.values[2][0];return new o(v,w,d).add(null!==(i=this.pivot)&&void 0!==i?i:new o(0,0,0))},t.prototype.rotatePoints=function(t){var n=this;return t.map(function(t){return n.rotatePoint(t)})},t}(),p=function(t,n){this.triangle=t,this.material=n,this.equation=this.triangle.getPlaneEquation()},f=function(){var t=function(n,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])},t(n,o)};return function(n,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),y=function(t){function n(n){var o=t.call(this,n)||this;return o.name="EquationError",o}return f(n,t),n}(Error),v=function(){var t=function(n,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])},t(n,o)};return function(n,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),w=function(t){function n(n){var o=t.call(this,n)||this;if(o.rows!==o.columns)throw new s("It's not a square matrix (".concat(o.rows,"x").concat(o.columns,")"));return o}return v(n,t),n.prototype.getDeterminant=function(t){if(void 0===t&&(t=1),2===this.rows&&2===this.columns)return t*this.values[0][0]*this.values[1][1]-t*this.values[0][1]*this.values[1][0];for(var o=0,i=0;i<this.columns;i++){for(var e=[],r=1;r<this.rows;r++){var s=this.values[r].slice();s.splice(i,1),e.push(s)}var a=t*this.values[0][i];o+=(i%2==0?1:-1)*new n(e).getDeterminant(a)}return o},n}(h),d=function(){function t(t){this.equations=t;var n=t.map(function(t){return t.coefficients.length});if(!u(n))throw new y("Different numbers of coefficients: ".concat(n))}return t.prototype.getSolution=function(){var t=new w(this.equations.map(function(t){return t.coefficients})),n=t.getDeterminant();if(0===n)return null;for(var o=[],i=0;i<t.columns;i++){for(var e=[],r=0;r<this.equations.length;r++){var s=this.equations[r].coefficients.slice();s[i]=-this.equations[r].constant,e.push(s)}o.push(new w(e).getDeterminant()/n)}return o},t}(),m=function(){var t=function(n,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])},t(n,o)};return function(n,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),g=function(t,n,o){if(o||2===arguments.length)for(var i,e=0,r=n.length;e<r;e++)!i&&e in n||(i||(i=Array.prototype.slice.call(n,0,e)),i[e]=n[e]);return t.concat(i||Array.prototype.slice.call(n))},x=function(t){function n(n){var o=t.call(this,n)||this;if(3!==n.length)throw new y("The number of equations must be 3. Now - "+n.length);if(3!==n[0].coefficients.length)throw new y("The number of variables must be 3. Now - "+n.length);return o}return m(n,t),n.prototype.getSolution=function(){return this.getSolutionByGauss()},n.prototype.getSolutionByGauss=function(){var t=this.equations.map(function(t){return g(g([],t.coefficients,!0),[t.constant],!1)}),n=t[0][0],o=t[0][1],i=t[0][2],e=t[0][3],r=t[1][0],s=t[1][1],a=t[1][2],c=t[1][3],u=t[2][0],h=t[2][1],l=t[2][2],p=r/n,f=u/n,y=s-o*p,v=(e*f-t[2][3]-(e*p-c)/y*(h-o*f))/(l-i*f-(a-i*p)/y*(h-o*f)),w=(e*p-c)/y-v*(a-i*p)/y;return[-e/n-w*o/n-v*i/n,w,v]},n}(d);function b(t,n){return Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y)+(t.z-n.z)*(t.z-n.z))}var _=function(t,n,o){if(o||2===arguments.length)for(var i,e=0,r=n.length;e<r;e++)!i&&e in n||(i||(i=Array.prototype.slice.call(n,0,e)),i[e]=n[e]);return t.concat(i||Array.prototype.slice.call(n))},z=function(){function t(){}return t.getIntersections=function(n,o,i){var e=[];return o.forEach(function(o){var r=new x(_(_([],n.equations,!0),[o.equation],!1)),s=t.getIntersectionPoint(r);s&&o.triangle.pointInside(s)&&((s.x>=n.line.point1.x&&s.x<=n.line.point2.x||s.x>=n.line.point2.x&&s.x<=n.line.point1.x)&&e.push({material:o.material,point:s,distance:b(n.line.point1,s),object:i}))}),e},t.getIntersectionPoint=function(t){var n=t.getSolution();return n?new o(n[0],n[1],n[2]):null},t}(),O=function(){function t(n){var o,i,e;this.name=null!==(o=n.name)&&void 0!==o?o:t.getDefaultName(this.constructor.name),this.type=this.constructor.name,this.position=n.position,this.rotation=null!==(i=n.rotation)&&void 0!==i?i:{x:0,y:0,z:0},this.material=null!==(e=n.material)&&void 0!==e?e:t.defaultMaterial,this.validateOpacity(),this.validateColor()}return t.getDefaultName=function(n){var o,i=null!==(o=t.constructorCounters[n])&&void 0!==o?o:0;return t.constructorCounters[n]=i+1,"".concat(n," ").concat(i)},t.prototype.validateOpacity=function(){var t=this.material.opacity;if(void 0!==t&&(t<0||t>1))throw new Error("opacity is not in interval [0, 1]. Current value - ".concat(t))},t.prototype.validateColor=function(){var t=this.material.color;if(t[0]<0||t[0]>255||t[1]<0||t[1]>255||t[2]<0||t[2]>255)throw new Error("incorrect value of the color - [".concat(t[0],", ").concat(t[1],", ").concat(t[2],"]"))},t.constructorCounters={},t.defaultMaterial={color:[255,255,255]},t}(),P=function(){var t=function(n,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])},t(n,o)};return function(n,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),M=function(t){function n(n){var o=t.call(this,n)||this;return o.meshes=o.getMeshes(n),o}return P(n,t),n.prototype.getIntersections=function(t){return z.getIntersections(t,this.meshes,this)},n}(O),S=function(){var t=function(n,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])},t(n,o)};return function(n,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),j=function(t){function n(n){return t.call(this,n)||this}return S(n,t),n.prototype.getMeshes=function(t){var n=this,i=t.sizeX,r=t.sizeY,s=t.sizeZ,a=(null!=i?i:1)/2,c=(null!=r?r:1)/2,u=(null!=s?s:1)/2,h=new l(this.rotation,this.position).rotatePoints([new o(this.position.x-a,this.position.y-c,this.position.z-u),new o(this.position.x+a,this.position.y-c,this.position.z-u),new o(this.position.x+a,this.position.y+c,this.position.z-u),new o(this.position.x-a,this.position.y+c,this.position.z-u),new o(this.position.x-a,this.position.y-c,this.position.z+u),new o(this.position.x+a,this.position.y-c,this.position.z+u),new o(this.position.x+a,this.position.y+c,this.position.z+u),new o(this.position.x-a,this.position.y+c,this.position.z+u)]);return[[h[3],h[4],h[7]],[h[0],h[3],h[4]],[h[0],h[2],h[3]],[h[0],h[1],h[2]],[h[1],h[4],h[5]],[h[0],h[1],h[4]],[h[4],h[6],h[7]],[h[4],h[5],h[6]],[h[3],h[6],h[7]],[h[2],h[3],h[6]],[h[2],h[5],h[6]],[h[1],h[2],h[5]]].map(function(t){var o=t[0],i=t[1],r=t[2];return new p(new e(o,i,r),n.material)})},n}(M),E=function(){var t=function(n,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])},t(n,o)};return function(n,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),I=function(){return I=Object.assign||function(t){for(var n,o=1,i=arguments.length;o<i;o++)for(var e in n=arguments[o])Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t},I.apply(this,arguments)},C=function(t,n){var o={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&n.indexOf(i)<0&&(o[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(i=Object.getOwnPropertySymbols(t);e<i.length;e++)n.indexOf(i[e])<0&&Object.prototype.propertyIsEnumerable.call(t,i[e])&&(o[i[e]]=t[i[e]])}return o},T=function(t){function n(n){var o=n.size,i=C(n,["size"]),e=null!=o?o:1;return t.call(this,I(I({},i),{sizeX:e,sizeY:e,sizeZ:e}))||this}return E(n,t),n}(j),A=function(){var t=function(n,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])},t(n,o)};return function(n,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),R=function(t){function n(n){return t.call(this,n)||this}return A(n,t),n.prototype.getMeshes=function(t){var n,i=this,r=t.sizeX/2,s=(null!==(n=t.sizeY)&&void 0!==n?n:t.sizeX)/2,a=new l(this.rotation,this.position).rotatePoints([new o(this.position.x-r,this.position.y-s,this.position.z),new o(this.position.x+r,this.position.y-s,this.position.z),new o(this.position.x+r,this.position.y+s,this.position.z),new o(this.position.x-r,this.position.y+s,this.position.z)]);return[[a[0],a[1],a[2]],[a[0],a[2],a[3]]].map(function(t){var n=t[0],o=t[1],r=t[2];return new p(new e(n,o,r),i.material)})},n}(M);function q(t,n){return Array(t).fill(null).map(function(t,o){return n(o)})}var N=function(){var t=function(n,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])},t(n,o)};return function(n,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),k=function(t,n,o){if(o||2===arguments.length)for(var i,e=0,r=n.length;e<r;e++)!i&&e in n||(i||(i=Array.prototype.slice.call(n,0,e)),i[e]=n[e]);return t.concat(i||Array.prototype.slice.call(n))},B=function(t){function i(n){return t.call(this,n)||this}return N(i,t),i.prototype.getMeshes=function(t){var n,i,r,s=this,a=null!==(n=t.angles)&&void 0!==n?n:3,c=null!==(i=t.radius)&&void 0!==i?i:1,u=null!==(r=t.hight)&&void 0!==r?r:1;if(a<3)throw new Error("amount of angles is less than 3 (".concat(a,")"));var h=new l(this.rotation,this.position),f=u/2,y=this.position.subtract(new o(0,0,f)),v=h.rotatePoint(y),w=this.getBaseVartices(y,a,c),d=h.rotatePoints(w),m=this.position.add(new o(0,0,f)),g=h.rotatePoint(m),x=this.getBaseVartices(m,a,c),b=h.rotatePoints(x),_=q(a,function(t){var n=(t+1)%a;return[new e(d[t],d[n],b[t]),new e(d[n],b[n],b[t])]}).flat();return k(k(k([],this.getBaseTriangles(v,d),!0),this.getBaseTriangles(g,b),!0),_,!0).map(function(t){return new p(t,s.material)})},i.prototype.getBaseVartices=function(t,o,i){var e=360/o;return q(o,function(o){return new n(i,0,e*o).toCartesian(t)})},i.prototype.getBaseTriangles=function(t,n){return q(n.length,function(o){return new e(t,n[o],n[(o+1)%n.length])})},i}(M);var D=function(){var t=function(n,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])},t(n,o)};return function(n,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),L=function(t){function n(n){var o,i=t.call(this,n)||this;return i.radius=null!==(o=n.radius)&&void 0!==o?o:1,i}return D(n,t),n.prototype.getIntersections=function(t){var n=this,i=t.line.point1,e=t.line.point2.subtract(i),r=this.position,s=this.radius,a=r.x,c=r.y,u=r.z,h=i.x,l=i.y,p=i.z,f=function(t,n,o){var i=n*n-4*t*o;if(i<0)return[];var e=2*t;if(0===i)return[-n/e];var r=Math.sqrt(i);return[(-n+r)/e,(-n-r)/e]}(e.x*e.x+e.y*e.y+e.z*e.z,2*(h*e.x-a*e.x+l*e.y-c*e.y+p*e.z-u*e.z),a*a+h*h+c*c+l*l+u*u+p*p-s*s-2*(a*h+c*l+u*p));return f.map(function(i){var r=new o(h+e.x*i,l+e.y*i,p+e.z*i);return{material:n.material,point:r,distance:b(t.line.point1,r),object:n}})},n}(O);function F(t){var n=new e(t.point1,t.point2,t.point1.add(new o(3.124543,6.83475,0))),i=new e(t.point1,t.point2,t.point1.add(new o(3.124543,0,6.83475)));return[n.getPlaneEquation(),i.getPlaneEquation()]}function X(t,n){var o={point1:t,point2:n};return{line:o,length:b(o.point1,o.point2),equations:F(o)}}var H=new(function(){function t(t){var n,o;this.backgroundColor=null!==(n=null==t?void 0:t.backgroundColor)&&void 0!==n?n:[0,0,0],this.objects=null!==(o=null==t?void 0:t.objects)&&void 0!==o?o:[],this.camera=t.camera}return t.prototype.addObjects=function(){for(var t,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];(t=this.objects).push.apply(t,n)},t.prototype.getObjects=function(){return this.objects},t}())({camera:new(function(){function t(t){var n=t.position,o=t.rotation,i=t.fov,e=t.distance,r=t.fogStart,s=t.resolution;this.canvasWidth=0,this.canvasHeight=0,this.canvasPixelSize=0,this.canvasCoordX=0,this.position=n,this.rotation=null!=o?o:{x:0,y:0,z:0},this.fov=null!=i?i:90,this.distance=null!=e?e:100,this.fogStart=null!=r?r:0,this.resolution=s,this.rotator=new l(this.rotation),this.validateDistance(),this.updateCanvasConfig(n)}return t.prototype.generateRay=function(t,n){var i=this.canvasPixelSize*t+this.canvasPixelSize/2-this.canvasWidth/2,e=this.canvasPixelSize*(this.resolution.height-n-1)+this.canvasPixelSize/2-this.canvasHeight/2,r=this.rotator.rotatePoint(new o(this.canvasCoordX,i,e));return X(this.position,r)},t.prototype.updateCanvasConfig=function(t){this.canvasWidth=2*this.distance*Math.tan(this.fov/2*Math.PI/180),this.canvasPixelSize=this.canvasWidth/this.resolution.width,this.canvasHeight=this.canvasPixelSize*this.resolution.height,this.canvasCoordX=this.position.x+this.distance,this.rotator=new l(this.rotation,null!=t?t:this.position)},t.prototype.validateDistance=function(){if(this.distance<=0)throw new Error("camera distance less or equals 0 (".concat(this.distance,")"))},t}())({position:new o(-7,-5,6),rotation:{x:0,y:11,z:17},distance:17,resolution:{width:384,height:216},fov:90}),objects:[new T({position:new o(0,-1,2.5),rotation:{x:0,y:0,z:-10},material:{color:[225,255,225]},size:5}),new j({name:"blue parallelepiped",position:new o(0,-5.4,1.5),rotation:{x:21,y:-12,z:15},material:{color:[200,200,255],opacity:.7},sizeX:4,sizeY:1,sizeZ:2}),new L({position:new o(-2,5,1.5),material:{color:[255,255,255]},radius:2}),new B({name:"red prism",rotation:{x:90,y:45,z:-40},position:new o(-3.5,0,1.5),material:{color:[255,200,200],opacity:.5},angles:3,hight:2,radius:1}),new R({position:new o(0,0,0),material:{color:[255,255,200]},sizeX:100})]}),V=function(){var t=function(n,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])},t(n,o)};return function(n,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),W=function(t){function n(n){var o=t.call(this,n)||this;return o.name="RendererError",o}return V(n,t),n}(Error);function Y(t){var n=document.querySelector("#".concat(t));if(n)return n;throw new Error("element '".concat(t,"' not found"))}var Z=function(){function t(t,n,o){void 0===o&&(o="black"),this.resolution=n,this.background=o,this.canvasEl=Y(t),this.canvasEl.width=n.width,this.canvasEl.height=n.height,this.context=this.getContext(this.canvasEl)}return t.prototype.clear=function(){this.context.fillStyle=this.background,this.context.clearRect(0,0,this.resolution.width,this.resolution.height)},t.prototype.drawLine=function(t,n,o,i){void 0===i&&(i=1),this.context.strokeStyle=this.colorToString(o),this.context.lineWidth=i,this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(t.x,t.y),this.context.lineTo(n.x,n.y),this.context.stroke()},t.prototype.drawPixel=function(t,n,o){this.context.fillStyle=this.colorToString(o),this.context.fillRect(t,n,1,1)},t.prototype.getContext=function(t){var n=t.getContext("2d");if(n)return n;throw new W("No contaxt for canvas element")},t.prototype.colorToString=function(t){return"rgb(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")")},t}();function G(t,n,o){void 0===o&&(o=.5);var i=1-o;return[t[0]*i+n[0]*o,t[1]*i+n[1]*o,t[2]*i+n[2]*o]}var U=function(t,n,o){if(o||2===arguments.length)for(var i,e=0,r=n.length;e<r;e++)!i&&e in n||(i||(i=Array.prototype.slice.call(n,0,e)),i[e]=n[e]);return t.concat(i||Array.prototype.slice.call(n))};var J=function(){this.time=0,this.interruptConfirmed=!1,this.primaryRays=0,this.totalRays=0,this.transparentIntersections=0,this.mode="main"},K=function(){function t(t,n){this.scene=t,this.canvasId=n,this.processingInfo=new J}return Object.defineProperty(t.prototype,"camera",{get:function(){return this.scene.camera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return this.camera.resolution},enumerable:!1,configurable:!0}),t.prototype.render=function(t){var n=this;void 0===t&&(t="main");var o=new Z(this.canvasId,this.resolution);return this.camera.updateCanvasConfig(),this.processingInfo=new J,this.processingInfo.mode=t,new Promise(function(t,i){n.runTask(t,i,n.resolution,o,0)})},t.prototype.interrupt=function(){this.processingInfo.interruptConfirmed=!0},t.prototype.runTask=function(t,n,o,i,e){var r=this;setTimeout(function(){for(var s=performance.now(),a=0;a<o.width;a++){var c=r.camera.generateRay(a,e);r.processingInfo.primaryRays++;var u=r.castRay(c,r.scene.getObjects());i.drawPixel(a,e,u)}var h=e+1;r.processingInfo.interruptConfirmed||h===o.height?(r.processingInfo.time+=performance.now()-s,t({time:r.processingInfo.time,primaryRays:r.processingInfo.primaryRays,totalRays:r.processingInfo.totalRays,transparentIntersections:r.processingInfo.transparentIntersections,progress:h/r.resolution.height,status:h===r.resolution.height?"success":"interrupted"})):(r.runTask(t,n,o,i,h),r.processingInfo.time+=performance.now()-s)})},t.prototype.castRay=function(t,n){var o;return this.processingInfo.totalRays++,n.forEach(function(n){n.getIntersections(t).forEach(function(t){(!o||t.distance<o.distance)&&(o=t)})}),"depthMap"===this.processingInfo.mode?this.getDephColor(o):o?this.handleIntersection(o,t,n):this.scene.backgroundColor},t.prototype.handleIntersection=function(t,n,o){var i,e,r,s=b(this.camera.position,t.point),a=G(t.material.color,this.scene.backgroundColor,this.getMixFogCoefficient(s)),c=t.material.opacity;if(void 0!==c&&1!==c){this.processingInfo.transparentIntersections++;var u=X(t.point,n.line.point2);return G(this.castRay(u,(i=o,e=t.object,-1===(r=i.indexOf(e))?i:U(U([],i.slice(0,r),!0),i.slice(r+1),!0))),a,c)}return a},t.prototype.getMixFogCoefficient=function(t){return t<this.camera.fogStart?0:(t-this.camera.fogStart)/(this.camera.distance-this.camera.fogStart)},t.prototype.getDephColor=function(t){var n=[0,0,0];if(t){var o=b(this.camera.position,t.point);return o>this.camera.distance?[255,0,0]:G([255,255,255],n,o/this.camera.distance)}return n},t}(),Q=function(){return Q=Object.assign||function(t){for(var n,o=1,i=arguments.length;o<i;o++)for(var e in n=arguments[o])Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t},Q.apply(this,arguments)},$=function(){function t(){}return t.add=function(n){t.counters[n]=t.counters[n]?t.counters[n]+1:1},t.log=function(){var n=Object.entries(t.counters).reduce(function(n,o){var i,e=o[0],r=o[1];return Q(Q({},n),((i={})[e]=t.formatter.format(r),i))},{});console.info(n)},t.reset=function(){t.counters={}},t.formatter=new Intl.NumberFormat("en-US",{compactDisplay:"short"}),t.counters={},t}(),tt=function(){function t(t){this.screen=new Z(t,{width:320,height:240},"transparent")}return t.prototype.render=function(t){var n=new o(-2,0,0),i=this.getVerticalFov(t),e=new o(0,0,0).subtract(n),r={x:-t.rotation.x,y:-t.rotation.y,z:-t.rotation.z},s=new l(r),a=s.rotatePoint(new o(1,0,0)).subtract(n),c=s.rotatePoint(new o(0,1,0)).subtract(n),u=s.rotatePoint(new o(0,0,1)).subtract(n),h=this.getAxisEndScreenPoint(e,a,t.fov,i),p=this.getAxisEndScreenPoint(e,c,t.fov,i),f=this.getAxisEndScreenPoint(e,u,t.fov,i),y={x:this.screen.resolution.width/2,y:this.screen.resolution.height/2},v=[0,0,0];this.screen.clear(),this.screen.drawLine(y,h,v,6),this.screen.drawLine(y,p,v,6),this.screen.drawLine(y,f,v,6),this.screen.drawLine(y,h,[255,0,0],4),this.screen.drawLine(y,p,[0,255,0],4),this.screen.drawLine(y,f,[0,0,255],4)},t.prototype.getAxisEndScreenPoint=function(t,n,e,r){var s=new i(t).getAngle(new i(new o(n.x,n.y,0))),a=new i(t).getAngle(new i(new o(n.x,0,n.z)));return n.y<0&&(s=-s),n.z<0&&(a=-a),{x:this.screen.resolution.width*(s+e/2)/e,y:this.screen.resolution.height-this.screen.resolution.height*(a+r/2)/r}},t.prototype.getVerticalFov=function(t){var n=t.resolution.height/t.resolution.width,o=t.fov*Math.PI/180;return 180*(2*Math.atan(Math.tan(o/2)*n))/Math.PI},t}();new(function(){function t(t){this.renderer=t,this.form={position:{x:Y("input-position-x"),y:Y("input-position-y"),z:Y("input-position-z")},rotation:{x:Y("input-rotation-x"),y:Y("input-rotation-y"),z:Y("input-rotation-z")},fov:Y("input-fov"),distance:Y("input-distance"),resolution:{width:Y("input-width"),height:Y("input-height")},renderButton:Y("button-render"),time:Y("div-time"),interruptRenderButton:Y("button-interrupt")},this.disabledElementsDuringRender=[this.form.position.x,this.form.position.y,this.form.position.z,this.form.rotation.x,this.form.rotation.y,this.form.rotation.z,this.form.fov,this.form.distance,this.form.resolution.width,this.form.resolution.height,this.form.renderButton],this.aspectRatio=this.renderer.camera.resolution.width/this.renderer.camera.resolution.height,this.axesRenderer=new tt("canvas-axes")}return t.prototype.init=function(){var t=this,n=this.renderer.camera;this.form.position.x.value=String(n.position.x),this.form.position.y.value=String(n.position.y),this.form.position.z.value=String(n.position.z),this.form.rotation.x.value=String(n.rotation.x),this.form.rotation.y.value=String(n.rotation.y),this.form.rotation.z.value=String(n.rotation.z),this.form.fov.value=String(n.fov),this.form.distance.value=String(n.distance),this.form.resolution.width.value=String(n.resolution.width),this.form.resolution.height.value=String(n.resolution.height),this.form.renderButton.addEventListener("click",function(){n.resolution={width:Number(t.form.resolution.width.value),height:Number(t.form.resolution.height.value)},n.position=new o(Number(t.form.position.x.value),Number(t.form.position.y.value),Number(t.form.position.z.value)),n.rotation={x:Number(t.form.rotation.x.value),y:Number(t.form.rotation.y.value),z:Number(t.form.rotation.z.value)},n.fov=Number(t.form.fov.value),n.distance=Number(t.form.distance.value),t.handleRender()}),this.form.interruptRenderButton.addEventListener("click",function(){t.renderer.interrupt()}),this.form.resolution.width.addEventListener("change",function(n){if(n.target instanceof HTMLInputElement){var o=Math.round(Number(n.target.value)/t.aspectRatio);t.form.resolution.height.value=String(o)}}),this.form.resolution.height.addEventListener("change",function(n){if(n.target instanceof HTMLInputElement){var o=Math.round(Number(n.target.value)*t.aspectRatio);t.form.resolution.width.value=String(o)}}),this.handleRender()},t.prototype.handleRender=function(){var t=this,n=this.form.interruptRenderButton;this.setDisabledFor(this.disabledElementsDuringRender,!0),n.disabled=!1,this.form.time.innerText="-",this.axesRenderer.render(this.renderer.camera),this.renderer.render().then(function(o){console.info(o),$.log(),t.form.time.innerText=(o.time/1e3).toFixed(3)+" s",t.setDisabledFor(t.disabledElementsDuringRender,!1),n.disabled=!0})},t.prototype.setDisabledFor=function(t,n){t.forEach(function(t){t.disabled=n})},t}())(new K(H,"canvas-main")).init()}},t=>{var n;n=787,t(t.s=n)}]);